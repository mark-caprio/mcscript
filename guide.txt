mcscript guide

M. A. Caprio
Department of Physics, University of Notre Dame

Last modified 6/13/16

----------------------------------------------------------------

  Environment setup
  
  Scripts which use mcscript should be launched using the qsubm
  utility.  This utility requires several configuration variables,
  with names of the form "QSUBM_*", to be defined in the environment.
  These variables are documented in the qsubm online help message.
  See also example definitions below.

  The Python interpreter which is running the job script must be
  able to find mcscript and its subsidiary modules.  It will therefore
  typically be necessary to set the environment variable PYTHONPATH to
  reflect this.

  A typical setup in a .cshrc initialization file would be:

    # configure python
    module load python
    module load mpi4py

    # mcscript/qsubm configuration
    # Note: this setenv PYTHONPATH appends to path defined above by module load mpi4py
    setenv PYTHONPATH ${HOME}/runs/mcscript:${PYTHONPATH}
    setenv QSUBM_RUN_HOME ${HOME}/runs
    setenv QSUBM_LAUNCH_HOME ${HOME}/runs
    setenv QSUBM_SCRATCH_HOME ${SCRATCH}/runs
    setenv QSUBM_RUN_PREFIX run

  Note that the Python interpreter which runs the job file may
  variously be running on the front end, a dedicated script node, or a
  compute node, depending on how the job is invoked.  Compute nodes
  may have poor access to the home filesystem, and even searching
  within the directory may be a slow process.  In such instances, it
  is therefore recommended (from hard experience) that the number of
  files in the directories in the Python search path be kept to a
  minimum, e.g., just the mcscript files.

  Local scripting setup

  It is also necessary to provide local definitions (i.e., specific to
  the local cluster and user) via the module file mcscript_local.py.
  The template file provided with this package should be modified as
  appropriate and placed in the Python search path (e.g., most simply,
  with the other mcscript files).

  Instructions for use in job script

  The mcscript package is meant to be called from a user's job file,
  written in Python, e.g., run0001.py.  To use the basic setup code
  and variable definitions provided by mcscript, the job file should
  start with

    import mcscript

  preferably as its first import statement.  This will automatically
  run the setup code.  At its end, the job script should then
  explicitly call the termination code

    mcscript.termination()

  The job script may then access various utility functions, e.g.,

    mcscript.call(["cat"],input_lines=["a","b"])

  The job script may also invoke mcscript's task management features,
  by first registering the tasks and handler functions, then invoking the main loop:
  
  mcscript.task.set_task_list(...)
  mcscript.task.set_phase_handlers(...)
  mcscript.task.task_master()
